<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Rat Hunter</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript" src="mapBackground.js"></script>
    <script type="text/javascript" src="modernizr.js"></script>

    <script>
      var mapTilesheet = new Image();
      mapTilesheet.src = "imgs/tilesheet.png";

      var firefoxTilesheet = new Image();
      firefoxTilesheet.src = "imgs/firefox.png";

      var indexOffset = -1;
      var tileSize = 32;
      var tileMap;
      var firefoxCharacter;
      var firefoxFrameIndex = 0;
      var allElements;

      function canvasSupport() {
        return Modernizr.canvas;
      }

      function mainDraw() {
        requestAnimationFrame(mainDraw);
          allElements.forEach(function(element) {
          element.draw()
        });
      }

      function init() {

        if (!canvasSupport()) {
          document.write("Your Browser doesn't support Canvas, please download the latest Mozilla Firefox Browser");
        } else {
          var canvas = document.getElementById("canvas");
          ctx = canvas.getContext("2d");
          requestAnimationFrame(mainDraw);

          tileMap = {
            draw: function() {
              var mapRows = 24;
              var mapCols = 32;
              var numberRowTiles = 30;

              //the following arrays can be found under mapBackground.js
              for (var r = 0; r < mapRows; r++) {
                for (var c = 0; c < mapCols; c++) {

                  // draws the background grass (first layer)
                  var tileID = grass[r][c] + indexOffset;
                  var sourceX = Math.floor(tileID % numberRowTiles) * tileSize;
                  var sourceY = Math.floor(tileID / numberRowTiles) * tileSize;
                  ctx.drawImage(mapTilesheet, sourceX, sourceY, tileSize, tileSize, c * tileSize, r * tileSize, tileSize, tileSize);

                  // draws the objects on the background (second layer)
                  tileID = objects[r][c] + indexOffset;
                  sourceX = Math.floor(tileID % numberRowTiles)  * tileSize;
                  sourceY = Math.floor(tileID / numberRowTiles) * tileSize;
                  ctx.drawImage(mapTilesheet, sourceX, sourceY, tileSize, tileSize, c * tileSize, r * tileSize, tileSize, tileSize);
                }
              }

            }
          }

          firefoxCharacter = {
            draw: function() {
              ctx.drawImage(firefoxTilesheet, 0, 32, 32, 32, 0, 0, 70, 70);
            }
          }

          allElements = [
            tileMap,
            firefoxCharacter
          ];

        }
      };
    </script>
  </head>

    <body onload="init();">

      <div id="title" align="center">
        Rat Hunter
      </div>

      <div id="centerCanvas">
        <canvas id="canvas" width="1024" height="768"></canvas>
      </div>
    </body>
</html>
